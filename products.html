<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Products - CareKart</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html">CareKart</a>
      <nav>
        <a href="products.html">Products</a>
        <a href="cart.html">Cart</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Our Products</h1>
    <div class="filters">
      <input type="text" id="searchBox" placeholder="Search products...">
      <select id="categoryFilter">
        <option value="">All Categories</option>
      </select>
    </div>
    <div id="productsGrid" class="products-grid"></div>
  </main>

  <script src="products-data.js"></script>
  <script>
    const grid = document.getElementById('productsGrid');
    const searchBox = document.getElementById('searchBox');
    const categoryFilter = document.getElementById('categoryFilter');

    // truncate helper
    function truncate(text, max = 80) {
      return text.length > max ? text.slice(0, max) + "..." : text;
    }

    // fill category filter
    const categories = [...new Set(window.PRODUCTS.map(p=>p.category))];
    categories.forEach(c=>{
      const opt=document.createElement('option');
      opt.value=c; opt.textContent=c;
      categoryFilter.appendChild(opt);
    });

    function render(filter){
      grid.innerHTML='';
      (window.PRODUCTS||[]).filter(p=>{
        if(filter?.q && !(`${p.name} ${p.description}`.toLowerCase().includes(filter.q.toLowerCase()))) return false;
        if(filter?.cat && filter.cat!=='') return p.category===filter.cat;
        return true;
      }).forEach(p=>{
        const card=document.createElement('div'); 
        card.className='product-card';
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <div class="product-info">
            <h3>${p.name}</h3>
            <p class="desc">${truncate(p.description, 80)}</p>
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="price">â‚¹ ${p.price.toFixed(2)}</div>
              <div class="actions">
                <button class="btn-details" data-id="${p.id}">Details</button>
                <button class="btn-add" data-id="${p.id}">Add to cart</button>
              </div>
            </div>
          </div>`;
        grid.appendChild(card);
      });

      // details button
      document.querySelectorAll('.btn-details').forEach(btn=>{
        btn.addEventListener('click',()=>{
          location.href=`product.html?id=${btn.dataset.id}`;
        });
      });

      // add to cart
      document.querySelectorAll('.btn-add').forEach(btn=>{
        btn.addEventListener('click',()=>{
          let cart=JSON.parse(localStorage.getItem('cart')||'[]');
          const prod=window.PRODUCTS.find(x=>x.id===btn.dataset.id);
          if(!cart.find(c=>c.id===prod.id)) cart.push({...prod,qty:1});
          localStorage.setItem('cart',JSON.stringify(cart));
          alert("Added to cart!");
        });
      });
    }

    render();

    searchBox.addEventListener('input',()=>{
      render({q:searchBox.value,cat:categoryFilter.value});
    });
    categoryFilter.addEventListener('change',()=>{
      render({q:searchBox.value,cat:categoryFilter.value});
    });
  </script>
</body>
</html>
