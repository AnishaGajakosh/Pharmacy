<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Product Details — CareKart</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="hamburger" id="hamburger" aria-label="Open menu">
          <span></span><span></span><span></span>
        </div>
        <a class="logo" href="index.html"> CareKart</a>
      </div>
      <nav class="main-nav">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
      </nav>
      <div class="titlebar">Safe medicines • Fast delivery</div>
    </div>
  </header>

  <aside class="sidebar" id="sidebar">
    <div class="profile">
      <div class="avatar" id="avatar">U</div>
      <div>
        <div class="welcome" id="welcome">Welcome, Guest</div>
        <div style="font-size:12px;color:var(--muted)">Customer</div>
      </div>
    </div>
    <div class="nav">
      <a href="login.html" id="loginLink">Login</a>
      <a href="register.html" id="registerLink">Register</a>
      <a href="index.html">Home</a>
      <a href="orders.html">My Orders</a>
      <a href="contact.html">Contact</a>
      <a href="about.html">About Us</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms & Conditions</a>
      <a href="refunds.html">Cancellation & Refund Policy</a>
      <a href="faq.html">FAQ</a>
      <a href="#" id="logoutLink" style="color:red;display:none">Sign Out</a>
    </div>
  </aside>

  <main class="container">
    <a href="products.html" class="back-arrow">← Back</a>
    <div id="product-detail" class="product-detail"></div>
  </main>

  <footer class="site-footer">
    <div class="container">© <span id="year"></span> CareKart. All rights reserved.</div>
  </footer>

  <script src="products.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Sidebar toggle
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    hamburger.addEventListener('click', (e) => {
      e.stopPropagation();
      sidebar.classList.toggle('open');
    });
    document.addEventListener('click', (e) => {
      if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !hamburger.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });

    // Auth state
    const user = JSON.parse(localStorage.getItem('user') || 'null');
    const logoutLink = document.getElementById("logoutLink");
    const loginLink = document.getElementById("loginLink");
    const registerLink = document.getElementById("registerLink");
    if (user) {
      document.getElementById('welcome').textContent = `Welcome, ${user.name}`;
      document.getElementById('avatar').textContent = (user.name || 'U').split(' ').map(s => s[0]).slice(0, 2).join('');
      logoutLink.style.display = "block";
      loginLink.style.display = "none";
      registerLink.style.display = "none";
    } else {
      logoutLink.style.display = "none";
      loginLink.style.display = "block";
      registerLink.style.display = "block";
    }
    logoutLink.addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      alert("You have been signed out.");
      window.location.href = "index.html";
    });

    // Cart counter
    const cartCount = (JSON.parse(localStorage.getItem('cart') || '[]')).reduce((s, i) => s + i.quantity, 0);
    document.getElementById('cart-count').textContent = cartCount;

    // Get product ID from URL
    const params = new URLSearchParams(window.location.search);
    const productId = params.get("id");

    function renderProduct() {
      const product = (window.PRODUCTS || []).find(p => p.id === productId);
      const container = document.getElementById("product-detail");
      if (!product) {
        container.innerHTML = "<p>Product not found.</p>";
        return;
      }
      container.innerHTML = `
        <div class="product-card detail-view">
          <img src="${product.image}" alt="${product.name}" style="max-width:300px;display:block;margin:auto">
          <h2>${product.name}</h2>
          <p>${product.description}</p>
          <div class="price">Price: ₹ ${product.price.toFixed(2)}</div>
          <button id="addToCartBtn" class="btn-add">Add to Cart</button>
        </div>
      `;
      document.getElementById("addToCartBtn").addEventListener("click", () => {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const existing = cart.find(it => it.id === product.id);
        if (existing) existing.quantity += 1;
        else cart.push({ id: product.id, name: product.name, price: product.price, quantity: 1 });
        localStorage.setItem("cart", JSON.stringify(cart));
        document.getElementById("cart-count").textContent = cart.reduce((s, i) => s + i.quantity, 0);
        showToast(`${product.name} added to cart`);
      });
    }

    document.addEventListener("productsLoaded", renderProduct);

    function showToast(msg) {
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position = 'fixed';
      t.style.right = '20px';
      t.style.bottom = '20px';
      t.style.background = 'rgba(0,0,0,0.8)';
      t.style.color = '#fff';
      t.style.padding = '10px 14px';
      t.style.borderRadius = '8px';
      t.style.zIndex = 9999;
      document.body.appendChild(t);
      setTimeout(() => { 
        t.style.opacity = '0'; 
        setTimeout(() => t.remove(), 400) 
      }, 2000);
    }
  </script>
</body>
</html>
