<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Order Confirmation - CareKart</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <a class="logo" href="index.html">CareKart</a>
    <div class="titlebar">Thank you for shopping with us!</div>
  </div>
</header>

<main class="container" id="confirmationBox">
  <h1>Thank you for your order! ðŸŽ‰</h1>
  <p>Loading order details...</p>
</main>

<script>
  const API_BASE = "https://pharmacy-oszy.onrender.com";

  async function loadOrder() {
    const params = new URLSearchParams(window.location.search);
    const orderId = params.get("id");
    const token = localStorage.getItem("token");

    if (!orderId || !token) {
      document.getElementById("confirmationBox").innerHTML = `
        <h1>Order not found</h1>
        <p>Please go back to <a href="index.html">Home</a>.</p>
      `;
      return;
    }

    try {
      const res = await fetch(`${API_BASE}/api/orders`, {
        headers: { "Authorization": "Bearer " + token }
      });
      const data = await res.json();

      if (!data.ok) {
        document.getElementById("confirmationBox").innerHTML = `
          <h1>Error</h1>
          <p>${data.error || "Unable to fetch order details."}</p>
        `;
        return;
      }

      const order = data.orders.find(o => o._id === orderId);
      if (!order) {
        document.getElementById("confirmationBox").innerHTML = `
          <h1>Order not found</h1>
          <p>Please go back to <a href="index.html">Home</a>.</p>
        `;
        return;
      }

      let itemsHtml = "";
      let total = 0;
      order.items.forEach(it => {
        total += it.price * it.quantity;
        itemsHtml += `
          <li>${it.name} Ã— ${it.quantity} - â‚¹${(it.price * it.quantity).toFixed(2)}</li>
        `;
      });

      document.getElementById("confirmationBox").innerHTML = `
        <h1>Thank you for your order! ðŸŽ‰</h1>
        <p><strong>Order ID:</strong> ${order._id}</p>
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
        <p><strong>Payment Method:</strong> ${order.paymentMethod}</p>

        <h3>Items</h3>
        <ul>${itemsHtml}</ul>
        <p><strong>Total: â‚¹${total.toFixed(2)}</strong></p>

        <h3>Shipping Information</h3>
        <p>
          ${order.shipping.name}, ${order.shipping.address}, ${order.shipping.city}, 
          ${order.shipping.state} - ${order.shipping.zip}<br>
          Phone: ${order.shipping.phone}
        </p>

        <a href="index.html" class="btn-add" style="margin-top:20px;display:inline-block">Continue Shopping</a>
      `;
    } catch (err) {
      console.error(err);
      document.getElementById("confirmationBox").innerHTML = `
        <h1>Error</h1>
        <p>Something went wrong loading your order.</p>
      `;
    }
  }

  loadOrder();
</script>

<style>
#confirmationBox{max-width:600px;margin:30px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
#confirmationBox h1{color:#28a745;margin-bottom:20px}
#confirmationBox ul{padding-left:20px}
.btn-add{background:#28a745;color:#fff;padding:12px 18px;border-radius:6px;text-decoration:none}
.btn-add:hover{background:#218838}
</style>
</body>
</html>
